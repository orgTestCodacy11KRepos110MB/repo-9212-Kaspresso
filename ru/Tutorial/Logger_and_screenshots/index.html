
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Recyclerview/">
      
      
        <link rel="next" href="../Screenshot_tests/">
      
      <link rel="icon" href="../../../kaspresso.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>12. Логирование и скриншоты - Kaspresso</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../../" title="Kaspresso" class="md-header__button md-logo" aria-label="Kaspresso" data-md-component="logo">
      
  <img src="../../../kaspresso.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kaspresso
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              12. Логирование и скриншоты
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Выберите язык">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="/Kaspresso/en/" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
              
                <li class="md-select__item">
                  <a href="/Kaspresso/ru/" hreflang="ru" class="md-select__link">
                    Русский
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/KasperskyLab/Kaspresso" title="Перейти к репозиторию" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Kaspresso
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Вкладки" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        Tutorial
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Wiki/" class="md-tabs__link">
        Wiki
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Issues/" class="md-tabs__link">
        Issues
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../" title="Kaspresso" class="md-nav__button md-logo" aria-label="Kaspresso" data-md-component="logo">
      
  <img src="../../../kaspresso.png" alt="logo">

    </a>
    Kaspresso
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/KasperskyLab/Kaspresso" title="Перейти к репозиторию" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Kaspresso
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" tabindex="0" aria-expanded="false">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        About Kaspresso
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Home/Kaspresso-in-articles/" class="md-nav__link">
        Kaspresso in articles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Home/Kaspresso-in-videos/" class="md-nav__link">
        Kasspresso in videos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Home/Kaspresso%20users/" class="md-nav__link">
        Our users
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Home/Breaking-changes/" class="md-nav__link">
        Breaking changes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Home/Contribution_guide/" class="md-nav__link">
        Contribution guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="true">
          Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        1. Введение
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Download_Kaspresso_project_and_Android_studio/" class="md-nav__link">
        2. Скачиваем проект и Android studio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Writing_simple_test/" class="md-nav__link">
        3. Пишем первый автотест с Kaspresso
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20adb-%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4/" class="md-nav__link">
        4. Выполнение adb-команд
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Wifi_sample_test/" class="md-nav__link">
        5. Wifi_sample_test
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%D0%92%D1%8B%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D0%BA%D1%86%D0%B8%D0%B9%20%D0%B8%20%D1%88%D0%B0%D0%B3%D0%BE%D0%B2/" class="md-nav__link">
        6. Выделение секций и шагов
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%D0%92%D1%8B%D0%BD%D0%B5%D1%81%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B4%D1%83%D0%B1%D0%BB%D0%B8%D1%80%D1%83%D1%8E%D1%89%D0%B8%D1%85%D1%81%D1%8F%20%D1%88%D0%B0%D0%B3%D0%BE%D0%B2%20%D0%B2%20Scenario/" class="md-nav__link">
        7. Вынесение дублирующихся шагов в Scenario
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UiAutomator/" class="md-nav__link">
        8. UiAutomator. Тестирование за рамками приложения
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../FlakySafely/" class="md-nav__link">
        9. flakySafely
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Android_permissions/" class="md-nav__link">
        10. Работа с Android permissions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Recyclerview/" class="md-nav__link">
        11. RecyclerView
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          12. Логирование и скриншоты
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        12. Логирование и скриншоты
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание раздела">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание раздела
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Внешняя система для тестовых данных
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Анализ проваленных тестов
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Добавление логов
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Скриншоты
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kaspressobuilder" class="md-nav__link">
    Настройка Kaspresso.Builder
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interceptors" class="md-nav__link">
    Interceptors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Итог
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Screenshot_tests/" class="md-nav__link">
        13. Screenshot-тесты
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../WebView/" class="md-nav__link">
        14. Работа с WebView
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Init_and_transform/" class="md-nav__link">
        15. Секции init и transform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Compose_and_continuously/" class="md-nav__link">
        16. Методы compose и continuously
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Customviews/" class="md-nav__link">
        17. Custom views
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Interceptors/" class="md-nav__link">
        18. Интерсепторы и режимы работы
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Compose_support/" class="md-nav__link">
        19. Compose support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Allure/" class="md-nav__link">
        20. Работа с Allure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../E2e_and_functional_tests/" class="md-nav__link">
        21. E2e и функциональные тесты с моками
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Robolectic/" class="md-nav__link">
        22. Поддержка Robolectic
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          Wiki
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Wiki" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Wiki
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Page_object_in_Kaspresso/" class="md-nav__link">
        PageObject in Kaspresso
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Espresso_as_the_basis/" class="md-nav__link">
        Espresso as the basis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Migrate_from_Espresso/" class="md-nav__link">
        Migrate from Espresso, Kakao or KAutomator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Supported_Android_UI_elements/" class="md-nav__link">
        Supported Android UI-elements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Matchers_actions_assertions/" class="md-nav__link">
        View matchers, actions and assertions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Kautomator-wrapper_over_UI_Automator/" class="md-nav__link">
        Kautomator. Wrapper over UI Automator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Executing_adb_commands/" class="md-nav__link">
        Executing adb commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Screenshot_tests/" class="md-nav__link">
        Screenshot tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Kaspresso_configuration/" class="md-nav__link">
        Kaspresso configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Working_with_Android_OS/" class="md-nav__link">
        Working with Android OS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Kaspresso_Robolectric/" class="md-nav__link">
        Kaspresso with Robolectric
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Kaspresso_Allure/" class="md-nav__link">
        Kaspresso with Allure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/E2e_and_Functional_tests/" class="md-nav__link">
        E2e and Functional tests. All in one
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Wiki/Jetpack_Compose/" class="md-nav__link">
        Jetpack Compose in Kaspresso
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          Issues
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Issues" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Issues
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Issues/" class="md-nav__link">
        Found an issue?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Issues/Storage_issue/" class="md-nav__link">
        Storage issues
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание раздела">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание раздела
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Внешняя система для тестовых данных
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Анализ проваленных тестов
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Добавление логов
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Скриншоты
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kaspressobuilder" class="md-nav__link">
    Настройка Kaspresso.Builder
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interceptors" class="md-nav__link">
    Interceptors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Итог
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="_1">Логирование и скриншоты</h1>
<p>В этом уроке мы научимся выявлять причины падающих тестов путем добавления дополнительных логов и скриншотов.</p>
<p>Вспомним пример, который уже использовался в одном из предыдущих уроков. Открываем приложение tutorial </p>
<p><img src="../images/logs/main_screen.png" alt="Tutorial main screen" width="300"/></p>
<p>и кликаем на кнопку <code>Login Activity</code></p>
<p><img src="../images/logs/login_activity.png" alt="Login Activity" width="300"/></p>
<p>На этом экране можно ввести логин и пароль, и, если они будут корректные, то откроется экран после авторизации. Корректными в данном случае считаются: логин длиной от трех символов, пароль – от шести.</p>
<p><img src="../images/logs/after_auth.png" alt="Screen after auth" width="300"/></p>
<h2 id="_2">Внешняя система для тестовых данных</h2>
<p>Мы уже писали тесты для этого экрана, они находятся в классе <code>LoginActivityTest</code></p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.test.ext.junit.rules.activityScenarioRule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.testcases.api.testcase.TestCase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.afterlogin.AfterLoginActivity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.login.LoginActivity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.junit.Rule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.junit.Test</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">LoginActivityTest</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TestCase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">Rule</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">activityRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activityScenarioRule</span><span class="o">&lt;</span><span class="n">MainActivity</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">loginSuccessfulIfUsernameAndPasswordCorrect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">run</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Try to login with correct username and password&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">scenario</span><span class="p">(</span>
<span class="w">                    </span><span class="n">LoginScenario</span><span class="p">(</span>
<span class="w">                        </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123456&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123456&quot;</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Check current screen&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">device</span><span class="p">.</span><span class="na">activities</span><span class="p">.</span><span class="na">isCurrent</span><span class="p">(</span><span class="n">AfterLoginActivity</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">loginUnsuccessfulIfUsernameIncorrect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">run</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Try to login with incorrect username&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">scenario</span><span class="p">(</span>
<span class="w">                    </span><span class="n">LoginScenario</span><span class="p">(</span>
<span class="w">                        </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;12&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123456&quot;</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Check current screen&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">device</span><span class="p">.</span><span class="na">activities</span><span class="p">.</span><span class="na">isCurrent</span><span class="p">(</span><span class="n">LoginActivity</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">loginUnsuccessfulIfPasswordIncorrect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">run</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Try to login with incorrect password&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">scenario</span><span class="p">(</span>
<span class="w">                    </span><span class="n">LoginScenario</span><span class="p">(</span>
<span class="w">                        </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123456&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;12345&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Check current screen&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">device</span><span class="p">.</span><span class="na">activities</span><span class="p">.</span><span class="na">isCurrent</span><span class="p">(</span><span class="n">LoginActivity</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>В этом тесте мы сами создаем логин и пароль, с которыми будем авторизоваться. Но бывают случаи, когда данные для теста мы получаем из какой-то внешней системы. Например, в проекте может быть какой-то сервис, который генерирует логин и пароль для входа, возвращает нам, и мы их используем для тестирования.</p>
<p>Давайте смоделируем эту ситуацию. Создадим класс, который возвращает данные для входа – логин и пароль.</p>
<p>В пакете <code>com.kaspersky.kaspresso.tutorial</code> создадим еще один пакет <code>data</code></p>
<p><img src="../images/logs/create_package.png" alt="Create package 1"/></p>
<p><img src="../images/logs/create_package_2.png" alt="Create package 2"/></p>
<p>В созданном пакете добавляем класс <code>TestData</code>, тип выбираем <code>Object</code></p>
<p><img src="../images/logs/create_class.png" alt="Create class"/></p>
<p>Как мы уже говорили ранее – здесь мы будем только моделировать ситуацию, когда данные для теста получаем из внешней системы. В созданном классе у нас будет два метода: один из них возвращает логин, другой – пароль. В реальных проектах эти данные мы бы запрашивали с сервера, и менять внутреннюю реализацию возможности у нас бы не было. То есть сейчас мы сами укажем, какие логин и пароль вернет система, но представляем, что для нас это «черный ящик», и мы не знаем, какие значения будут получены.</p>
<p>Добавляем в этом классе два метода и пусть они возвращают корректные логин и пароль:</p>
<p><div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.data</span>

<span class="kd">object</span><span class="w"> </span><span class="nc">TestData</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateUsername</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Admin&quot;</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generatePassword</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123456&quot;</span>
<span class="p">}</span>
</code></pre></div>
Теперь давайте создадим отдельный класс теста, в котором будем выполнять проверку успешного логина с помощью данных, полученных от класса <code>TestData</code>. Тестовый класс назовем <code>LoginActivityGeneratedDataTest</code>. Можем скопировать проверку успешного логина из класса <code>LoginActivityTest</code></p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.test.ext.junit.rules.activityScenarioRule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.testcases.api.testcase.TestCase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.afterlogin.AfterLoginActivity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.junit.Rule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.junit.Test</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">LoginActivityGeneratedDataTest</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TestCase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">Rule</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">activityRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activityScenarioRule</span><span class="o">&lt;</span><span class="n">MainActivity</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">loginSuccessfulIfUsernameAndPasswordCorrect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">run</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Try to login with correct username and password&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">scenario</span><span class="p">(</span>
<span class="w">                    </span><span class="n">LoginScenario</span><span class="p">(</span>
<span class="w">                        </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123456&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123456&quot;</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Check current screen&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">device</span><span class="p">.</span><span class="na">activities</span><span class="p">.</span><span class="na">isCurrent</span><span class="p">(</span><span class="n">AfterLoginActivity</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Здесь мы используем захардкоженные логин и пароль, давайте получим их из класса <code>TestData</code></p>
<p><div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.test.ext.junit.rules.activityScenarioRule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.testcases.api.testcase.TestCase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.afterlogin.AfterLoginActivity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.data.TestData</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.junit.Rule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.junit.Test</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">LoginActivityGeneratedDataTest</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TestCase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">Rule</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">activityRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activityScenarioRule</span><span class="o">&lt;</span><span class="n">MainActivity</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">loginSuccessfulIfUsernameAndPasswordCorrect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">run</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestData</span><span class="p">.</span><span class="na">generateUsername</span><span class="p">()</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestData</span><span class="p">.</span><span class="na">generatePassword</span><span class="p">()</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Try to login with correct username and password&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">scenario</span><span class="p">(</span>
<span class="w">                    </span><span class="n">LoginScenario</span><span class="p">(</span>
<span class="w">                        </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">username</span><span class="p">,</span>
<span class="w">                        </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Check current screen&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">device</span><span class="p">.</span><span class="na">activities</span><span class="p">.</span><span class="na">isCurrent</span><span class="p">(</span><span class="n">AfterLoginActivity</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Запускаем. Тест пройден успешно.</p>
<h2 id="_3">Анализ проваленных тестов</h2>
<p>Мы проверили, что, если система возвращает корректные данные, то тест проходит успешно. Давайте внесем изменения в класс <code>TestData</code>, чтобы он возвращал неверные значения</p>
<p><div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.data</span>

<span class="kd">object</span><span class="w"> </span><span class="nc">TestData</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateUsername</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Adm&quot;</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generatePassword</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123&quot;</span>
<span class="p">}</span>
</code></pre></div>
Запускаем тест еще раз. На этот раз тест падает. </p>
<p>Мы уже говорили о том, что в реальных проектах влиять на внешнюю систему мы не можем, и иногда она может возвращать некорректные данные, из-за чего тест будет падать. Если тест упал, то нужно провести анализ и определить, в чем была проблема: в тестах, в неправильно работающем приложении или во внешней системе. Давайте попробуем определить это из логов. Открываем Logcat и фильтруем лог по тэгу <code>KASPRESSO</code></p>
<p><img src="../images/logs/logcat.png" alt="Test failed"/></p>
<p>Что мы отсюда видим? Попытка залогиниться прошла успешно, а проверка на то, что после успешного логина открыт нужный экран – провалилась.</p>
<p>При этом, отсюда совершенно неясно, почему проблема возникла. Мы не видим, с какими данными была попытка залогиниться, действительно ли они корректные, и непонятно, как решать возникшую проблему. Результат был бы более понятный, если бы в логах содержалась информация – какие конкретно логин и пароль были использованы во время тестирования. </p>
<h2 id="_4">Добавление логов</h2>
<p>Если нам нужно добавить какую-то свою информацию в логи, то можем использовать объект <code>testLogger</code>, у которого необходимо вызвать метод <code>i</code> (от слова <code>info)</code>, и в качестве параметра передать текст, который нужно залогировать.</p>
<p>Логин и пароль у нас генерируются перед шагом <code>step("Try to login with correct username and password")</code> можем в этом месте вывести в лог сообщение о том, какие именно данные были сгенерированы</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.test.ext.junit.rules.activityScenarioRule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.testcases.api.testcase.TestCase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.afterlogin.AfterLoginActivity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.data.TestData</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.junit.Rule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.junit.Test</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">LoginActivityGeneratedDataTest</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TestCase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">Rule</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">activityRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activityScenarioRule</span><span class="o">&lt;</span><span class="n">MainActivity</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">loginSuccessfulIfUsernameAndPasswordCorrect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">run</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestData</span><span class="p">.</span><span class="na">generateUsername</span><span class="p">()</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestData</span><span class="p">.</span><span class="na">generatePassword</span><span class="p">()</span>

<span class="w">            </span><span class="n">testLogger</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="s">&quot;Generated data. Username: </span><span class="si">$</span><span class="n">username</span><span class="s">, Password: </span><span class="si">$</span><span class="n">password</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Try to login with correct username and password&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">scenario</span><span class="p">(</span>
<span class="w">                    </span><span class="n">LoginScenario</span><span class="p">(</span>
<span class="w">                        </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">username</span><span class="p">,</span>
<span class="w">                        </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Check current screen&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">device</span><span class="p">.</span><span class="na">activities</span><span class="p">.</span><span class="na">isCurrent</span><span class="p">(</span><span class="n">AfterLoginActivity</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>В этой строчке <code>testLogger.i("Generated data. Username: $username, Password: $password")</code> мы вызываем метод <code>i</code> у объекта <code>testLogger</code>, в качестве параметра передаем строку <code>"Generated data. Username: $username, Password: $password")</code>, где вместо <code>$username</code> и <code>$password</code> будут подставлены значения переменных логин и пароль.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Подробнее о том, как формировать строку с использованием переменных и методов, можно почитать в <a href="https://kotlinlang.org/docs/strings.html#string-templates">документации</a></p>
</div>
<p>Давайте запустим тест еще раз и посмотрим логи:</p>
<p><img src="../images/logs/custom_log.png" alt="Custom Log"/></p>
<p>После <code>TEST SECTION</code> видно наш лог, который выводится с тэгом <code>KASPRESSO_TEST</code>. В этом логе видно, что сгенерированные данные некорректные (пароль слишком короткий), а значит тест падает из-за внешней системы, и решать проблему нужно именно в ней. </p>
<p>Если вы не хотите смотреть полностью весь лог, и вас интересуют только сообщения, добавленные вами, то можете отфильтровать журнал по тэгу <code>KASPRESSO_TEST</code></p>
<p><img src="../images/logs/kaspresso_test_tag.png" alt="Kaspresso test tag"/></p>
<h2 id="_5">Скриншоты</h2>
<p>Логи действительно очень полезны при анализе тестов и поиске ошибок, но бывают случаи, когда гораздо проще найти проблему по скриншотам. Если бы во время теста на каждом шаге сохранялся скриншот, и потом мы могли бы посмотреть их в какой-то папке, то поиск ошибок был бы намного проще.</p>
<p>В Kaspresso есть возможность во время теста делать скриншоты на любом шаге, для этого достаточно вызвать метод <code>device.screenshots.take("file_name")</code>. Вместо <code>file_name</code> нужно указать название файла скриншота, по которому вы сможете его найти. Давайте в каждый шаг <code>LoginScenario</code> мы добавим скриншоты, чтобы потом проанализировать все, что происходило на экране.</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.testcases.api.scenario.Scenario</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.testcases.core.testcontext.TestContext</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.screen.LoginScreen</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.screen.MainScreen</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">LoginScenario</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">username</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Scenario</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">steps</span><span class="p">:</span><span class="w"> </span><span class="n">TestContext</span><span class="o">&lt;</span><span class="kt">Unit</span><span class="o">&gt;</span><span class="p">.()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Open login screen&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">device</span><span class="p">.</span><span class="na">screenshots</span><span class="p">.</span><span class="na">take</span><span class="p">(</span><span class="s">&quot;before_open_login_screen&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">MainScreen</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">loginActivityButton</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isVisible</span><span class="p">()</span>
<span class="w">                    </span><span class="n">isClickable</span><span class="p">()</span>
<span class="w">                    </span><span class="n">click</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">device</span><span class="p">.</span><span class="na">screenshots</span><span class="p">.</span><span class="na">take</span><span class="p">(</span><span class="s">&quot;after_open_login_screen&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Check elements visibility&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">device</span><span class="p">.</span><span class="na">screenshots</span><span class="p">.</span><span class="na">take</span><span class="p">(</span><span class="s">&quot;check_elements_visibility&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">LoginScreen</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">inputUsername</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isVisible</span><span class="p">()</span>
<span class="w">                    </span><span class="n">hasHint</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">login_activity_hint_username</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">inputPassword</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isVisible</span><span class="p">()</span>
<span class="w">                    </span><span class="n">hasHint</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">login_activity_hint_password</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">loginButton</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isVisible</span><span class="p">()</span>
<span class="w">                    </span><span class="n">isClickable</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Try to login&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">LoginScreen</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">inputUsername</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">replaceText</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
<span class="w">                    </span><span class="n">device</span><span class="p">.</span><span class="na">screenshots</span><span class="p">.</span><span class="na">take</span><span class="p">(</span><span class="s">&quot;setup_username&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">inputPassword</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">replaceText</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
<span class="w">                    </span><span class="n">device</span><span class="p">.</span><span class="na">screenshots</span><span class="p">.</span><span class="na">take</span><span class="p">(</span><span class="s">&quot;setup_password&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">loginButton</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">click</span><span class="p">()</span>
<span class="w">                    </span><span class="n">device</span><span class="p">.</span><span class="na">screenshots</span><span class="p">.</span><span class="na">take</span><span class="p">(</span><span class="s">&quot;after_click_login&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Для того чтобы скриншоты сохранились на устройстве, у приложения должно быть дано разрешение на чтение и запись в файловую систему смартфона. Поэтому в тестовом классе мы дадим соответствующее разрешение через <code>GrantPermissionRule</code></p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.test.ext.junit.rules.activityScenarioRule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.test.rule.GrantPermissionRule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.testcases.api.testcase.TestCase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.afterlogin.AfterLoginActivity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.data.TestData</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.junit.Rule</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.junit.Test</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">LoginActivityGeneratedDataTest</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TestCase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">Rule</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">activityRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activityScenarioRule</span><span class="o">&lt;</span><span class="n">MainActivity</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">Rule</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">permissionRule</span><span class="p">:</span><span class="w"> </span><span class="n">GrantPermissionRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GrantPermissionRule</span><span class="p">.</span><span class="na">grant</span><span class="p">(</span>
<span class="w">        </span><span class="n">android</span><span class="p">.</span><span class="na">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">READ_EXTERNAL_STORAGE</span><span class="p">,</span>
<span class="w">        </span><span class="n">android</span><span class="p">.</span><span class="na">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">WRITE_EXTERNAL_STORAGE</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">loginSuccessfulIfUsernameAndPasswordCorrect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">run</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestData</span><span class="p">.</span><span class="na">generateUsername</span><span class="p">()</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestData</span><span class="p">.</span><span class="na">generatePassword</span><span class="p">()</span>

<span class="w">            </span><span class="n">testLogger</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="s">&quot;Generated data. Username: </span><span class="si">$</span><span class="n">username</span><span class="s">, Password: </span><span class="si">$</span><span class="n">password</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Try to login with correct username and password&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">scenario</span><span class="p">(</span>
<span class="w">                    </span><span class="n">LoginScenario</span><span class="p">(</span>
<span class="w">                        </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">username</span><span class="p">,</span>
<span class="w">                        </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Check current screen&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">device</span><span class="p">.</span><span class="na">activities</span><span class="p">.</span><span class="na">isCurrent</span><span class="p">(</span><span class="n">AfterLoginActivity</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Запускаем тест еще раз.</p>
<p>После выполнения теста перейдите в <code>Device File Explorer</code> и откройте папку <code>sdcard/Documents/screenshots</code>. Если она у вас не отображается, то кликните правой кнопкой по папке <code>sdcard</code> и нажмите <code>Synchronize</code></p>
<p><img src="../images/logs/screenshots.png" alt="Screenshots"/></p>
<p>Здесь по скриншотам можно определить, в чем проблема – на этапе установки пароля количество введенных символов – 3</p>
<p><img src="../images/logs/setup_password.png" alt="Setup password"/></p>
<p>Так, проанализировав скриншоты, можно определить, какая ошибка возникла в момент проведения тестов.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Один из способов сделать скриншот – вызвать метод <code>device.uiDevice.takeScreenshot</code>. Это метод из библиотеки <code>uiautomator</code> и использовать его напрямую никогда не следует. </p>
<p>Во-первых, скриншот, сделанный при помощи Kaspresso (<code>device.screenshots.take</code>), будет лежать в нужной папке, которую легко найти по названию теста, и файлы для каждого теста и шага будут находиться в своих папках с понятными названиями, а в случае с <code>uiautomator</code> находить нужные скриншоты будет проблематично. </p>
<p>Во-вторых, в Kaspresso сделано множество удобных доработок по работе со скриншотами таких как: масштабирование, настройка качества фото, полноэкранные скрины (когда весь контент не помещается на экране) и так далее. </p>
<p>Поэтому для скриншотов всегда используйте только объекты Kaspresso <code>device.screenshots</code>.</p>
</div>
<h2 id="kaspressobuilder">Настройка Kaspresso.Builder</h2>
<p>Теоретически, все тесты, которые вы пишете, могут упасть. В таких случаях хотелось бы всегда иметь возможность посмотреть скриншоты, чтобы понять, что пошло не так. Как этого добиться? Как вариант – во все шаги всех тестов добавлять вызов метода, который делает скриншот, но это не слишком удобно.</p>
<p>Поэтому в Kaspresso была добавлена возможность настройки параметров теста при создании тестового класса. Для этого в конструктор <code>TestCase</code> можно передать объект <code>Kaspresso.Builder</code>, который по умолчанию принимает значение <code>Kaspresso.Builder.simple()</code>.</p>
<p><img src="../images/logs/test_case_params.png" alt="Test Case Params"/></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Чтобы посмотреть параметры, которые принимает метод или конструктор, можно кликнуть левой кнопкой мыши внутри круглых скобок и нажать комбинацию клавиш <code>ctrl + P</code> (или <code>cmd + P</code> на Mac)</p>
</div>
<p>Мы можем добавить множество разных настроек, подробнее о которых можно почитать в <a href="https://kasperskylab.github.io/Kaspresso/Wiki/Kaspresso_configuration/">Wiki</a>.</p>
<p>Сейчас нас интересует добавление скриншотов, если тесты упали. Самый простой вариант сделать это – использовать <code>advanced</code> builder вместо <code>simple</code>. Делается это следующим образом:</p>
<p><div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">LoginActivityGeneratedDataTest</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TestCase</span><span class="p">(</span>
<span class="w">    </span><span class="n">kaspressoBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kaspresso</span><span class="p">.</span><span class="na">Builder</span><span class="p">.</span><span class="na">advanced</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
В этом случае вызов методов, которые делают скриншоты, можно убрать, они будут сохранены автоматически, если тест упадет.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Обратите внимание, что разрешения на доступ к файловой системе нужны обязательно, без них скриншоты сохранены не будут</p>
</div>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.testcases.api.scenario.Scenario</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.testcases.core.testcontext.TestContext</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.screen.LoginScreen</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.screen.MainScreen</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">LoginScenario</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">username</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">password</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Scenario</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">steps</span><span class="p">:</span><span class="w"> </span><span class="n">TestContext</span><span class="o">&lt;</span><span class="kt">Unit</span><span class="o">&gt;</span><span class="p">.()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Open login screen&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">MainScreen</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">loginActivityButton</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isVisible</span><span class="p">()</span>
<span class="w">                    </span><span class="n">isClickable</span><span class="p">()</span>
<span class="w">                    </span><span class="n">click</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Check elements visibility&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">LoginScreen</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">inputUsername</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isVisible</span><span class="p">()</span>
<span class="w">                    </span><span class="n">hasHint</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">login_activity_hint_username</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">inputPassword</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isVisible</span><span class="p">()</span>
<span class="w">                    </span><span class="n">hasHint</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">login_activity_hint_password</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">loginButton</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isVisible</span><span class="p">()</span>
<span class="w">                    </span><span class="n">isClickable</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Try to login&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">LoginScreen</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">inputUsername</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">replaceText</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">inputPassword</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">replaceText</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">loginButton</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">click</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Запускаем тест. Тесты упали, и на устройстве появились скриншоты (не забывайте нажимать <code>Synchronize</code>):</p>
<p><img src="../images/logs/advanced_builder.png" alt="Advanced Builder"/></p>
<p>При использовании <code>advanced</code> builder-а появляется еще несколько изменений. Кроме скриншотов добавляются также файлы с логами, иерархией View и другое.</p>
<p>Если все эти изменения вам не нужны, то можно изменить только определенные настройки простого builder-а. </p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Если вы не разработчик, то кастомизация builder-а по умолчанию может быть достаточно сложной. В случае, если разобраться с настройкой не удалось, используйте <code>advanced</code> builder для получения скриншотов</p>
</div>
<h2 id="interceptors">Interceptors</h2>
<p>Вы должны помнить, что в предыдущих тестах, кроме выполнения наших методов, «под капотом» происходило много дополнительных действий: запись логов для каждого шага, неявный вызов flakySafely, автоматический скролл до элемента, если проверка выполнилась неуспешно и так далее.</p>
<p>Все это работало благодаря <code>Interceptor</code>-ам. <code>Interceptors</code> — это классы, которые перехватывают вызываемые нами действия и добавляют в них какую-то функциональность. Таких классов в Kaspresso достаточно много, подробнее о них вы можете почитать в <a href="https://kasperskylab.github.io/Kaspresso/Wiki/Kaspresso_configuration/">документации</a></p>
<p>Нас интересует добавление скриншотов, за это отвечают классы <code>ScreenshotStepWatcherInterceptor</code>, <code>ScreenshotFailStepWatcherInterceptor</code> и <code>TestRunnerScreenshotWatcherInterceptor</code>.</p>
<ul>
<li>ScreenshotStepWatcherInterceptor – добавляет скриншоты независимо от того, шаг завершился с ошибкой или нет
</li>
<li>ScreenshotFailStepWatcherInterceptor – добавляет скриншот только того шага, который завершился с ошибкой
</li>
<li>TestRunnerScreenshotWatcherInterceptor – добавляет скриншот, если произошла ошибка в секции `before` или `after`
</li>
</ul>

<p>Если тест падает, то удобно смотреть не только шаг, на котором произошла ошибка, но и предыдущие – таким образом разобраться в проблеме бывает гораздо проще. Поэтому мы добавим первый вариант <code>Interceptor</code>-а, который скриншотит все шаги, независимо от результата. Делается это следующим образом:</p>
<p><div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">LoginActivityGeneratedDataTest</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TestCase</span><span class="p">(</span>
<span class="w">    </span><span class="n">kaspressoBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kaspresso</span><span class="p">.</span><span class="na">Builder</span><span class="p">.</span><span class="na">simple</span><span class="p">().</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">stepWatcherInterceptors</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ScreenshotStepWatcherInterceptor</span><span class="p">(</span><span class="n">screenshots</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
Здесь мы сначала получаем builder по умолчанию, вызываем у него метод <code>apply</code> и в фигурных скобках добавляем все необходимые настройки. В данном случае мы получаем все <code>Interceptor</code>-ы, которые перехватывают событие выполнения шагов (<code>step</code>) и добавляем туда <code>ScreenshotStepWatcherInterceptor</code>, передавая ему в конструктор объект <code>screenshots</code>.</p>
<p>Теперь, когда мы добавили данный <code>Interceptor</code>, после каждого шага теста, независимо от результата его выполнения, на устройстве будут сохранены скриншоты.</p>
<p>Запускаем. Тест завершился неудачно, и на устройстве были сохранены скриншоты</p>
<p><img src="../images/logs/customized_builder.png" alt="Customized Builder"/></p>
<p>Давайте вернем корректную реализацию класса <code>TestData</code></p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.kaspersky.kaspresso.tutorial.data</span>

<span class="kd">object</span><span class="w"> </span><span class="nc">TestData</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generateUsername</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Admin&quot;</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">generatePassword</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123456&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>Запустим тест еще раз. Тест пройден успешно, и все скриншоты сохранены на устройстве.</p>
<h2 id="_6">Итог</h2>
<p>В этом уроке мы узнали, как в наши тесты добавить логирование и скриншоты. Узнали, в каких случаях стандартных логов бывает недостаточно, научились настраивать <code>Kaspresso.Builder</code>, добавляя в него различные <code>Interceptor</code>-ы.
Также мы рассмотрели способы, как создавать скриншоты вручную, и как этот процесс можно автоматизировать. </p>
<p><br></p>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            К началу
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["tabs", "navigation.tabs", "content.code.annotate", "navigation.tabs.sticky", "navigation.instant", "navigation.tracking", "navigation.top", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>